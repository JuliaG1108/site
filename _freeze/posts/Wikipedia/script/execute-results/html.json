{
  "hash": "b2843e30ae73e34b4f65c435dcb16702",
  "result": {
    "markdown": "---\ntitle: \"Webscraping no Wikipédia\"\nauthor: \"Júlia Gualberto\"\ndate: \"2022-07-19\"\ncategories: [code, analysis, python]\nimage: \"wikipedia.jpg\"\n---\n\n\nO seguinte código visa extrair uma tabela de municípios do estado do Espírito Santo disponibilizado no site Wikipédia, através de métodos de Webscraping.\n\n\n\n\n\nNum primeiro momento, iremos baixar a página desejada da web.\n\n\n::: {.cell}\n\n```{.python .cell-code}\n#!pip install bs4\n#!pip install requests\n\nfrom bs4 import BeautifulSoup\nimport pandas as pd\nimport requests\nurl = requests.get(\"https://pt.wikipedia.org/wiki/Lista_de_munic%C3%ADpios_do_Esp%C3%ADrito_Santo_por_popula%C3%A7%C3%A3o\")\n#print(url.status_code)\n```\n:::\n\n\nAgora, iremos exibir o conteúdo HTML da página, formatado corretamente e armazena-lo no objeto soup.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nsoup = BeautifulSoup(url.content, 'html.parser')\n\n#print(soup.prettify())\n```\n:::\n\n\nExtraindo a tabela:\n\n\n::: {.cell}\n\n```{.python .cell-code}\ntabela = soup.find('table')\n\n#print(tabela)\n```\n:::\n\n\nExtraindo os títulos das colunas:\n\n\n::: {.cell}\n\n```{.python .cell-code}\ntitulos = [i.text for i in tabela.find_all('th')]\n\n#print(titulos)\n```\n:::\n\n\nCriando o dataframe que armazenará nossa tabela com as informações dos municípios.\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndf = pd.DataFrame(columns = titulos)\n\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nEmpty DataFrame\nColumns: [Posição, Município, População\n]\nIndex: []\n```\n:::\n:::\n\n\nAgora iremos coletar as informações que preencherão nossa tabela:\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfor j in tabela.find_all('tr')[1:]:\n    row_data = j.find_all('td')\n    row = [i.text for i in row_data]\n    length = len(df)\n    df.loc[length] = row\n```\n:::\n\n\nTeremos algo nesse formato:\n\n\n::: {.cell}\n\n```{.python .cell-code}\nprint(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Posição                 Município População\\n\n0        1                     Serra   527.240\\n\n1        2                Vila Velha   501.325\\n\n2        3                 Cariacica   383.917\\n\n3        4                   Vitória   365.855\\n\n4        5   Cachoeiro de Itapemirim   210.589\\n\n..     ...                       ...         ...\n73      74             Alto Rio Novo     7 836\\n\n74      75                    Apiacá     7 567\\n\n75      76        Dores do Rio Preto     6 749\\n\n76      77                  Mucurici     5 524\\n\n77      78    Divino de São Lourenço     4 304\\n\n\n[78 rows x 3 columns]\n```\n:::\n:::\n\n\nNo entanto, percebemos alguns detalhes indesejados na nossa tabela, como por exemplo, o final \\\\\\ n e \\[2\\] na linha 16.\n\n\n::: {.cell}\n\n```{.python .cell-code}\npopulacao = df['População\\n']\n\npopulacao1 = [i.split('\\n')[0].replace('\\xa0','.').split('[2]')[0] for i in populacao]\n\ndf['População\\n'] = populacao1\n\ndf = df.rename(columns={'População\\n': 'População'}) \nprint(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Posição                 Município População\n0        1                     Serra   527.240\n1        2                Vila Velha   501.325\n2        3                 Cariacica   383.917\n3        4                   Vitória   365.855\n4        5   Cachoeiro de Itapemirim   210.589\n..     ...                       ...       ...\n73      74             Alto Rio Novo     7 836\n74      75                    Apiacá     7 567\n75      76        Dores do Rio Preto     6 749\n76      77                  Mucurici     5 524\n77      78    Divino de São Lourenço     4 304\n\n[78 rows x 3 columns]\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}